/* angular-soil 0.9.2 %> */

(function(){angular.module("soil.association",["soil.collection"]).factory("HasOneAssociation",[function(){var a;return a=function(){function a(a,b,c){this._field=a,this._modelClass=b,null==c&&(c={}),this._options=_.defaults(c,{saveData:!1}),this._idField=this._field+"_id"}return a.prototype.beforeLoad=function(a){return a[this._field]?a[this._field]=new this._modelClass(a[this._field]):a[this._idField]?(a[this._field]=new this._modelClass(a[this._idField]),delete a[this._idField]):void 0},a.prototype.beforeSave=function(a){return a[this._field]?this._options.saveData?a[this._field]=a[this._field].dataToSave():(a[this._idField]=a[this._field].id,delete a[this._field]):void 0},a}()}]).factory("HasManyAssociation",["SoilCollection",function(a){var b;return b=function(){function b(a,b,c,d){this._field=a,this._idField=b,this._modelClass=c,null==d&&(d={}),this._options=_.defaults(d,{saveData:!1})}return b.prototype.beforeLoad=function(b,c){var d,e;return b[this._field]?(e=c.url(b.id||c.id),d=new a(this._modelClass,e+"/"+this._field),b[this._field]=d.load(b[this._field])):void 0},b.prototype.beforeSave=function(a){return a[this._field]?this._options.saveData?a[this._field]=_.map(a[this._field].members,function(a){return a.dataToSave()}):(a[this._idField]=_.map(a[this._field].members,function(a){return a.id}),delete a[this._field]):void 0},b}()}])}).call(this),function(){angular.module("soil.collection",[]).factory("SoilCollection",["$http",function(a){var b;return b=function(){function b(a,b){this.modelClass=a,this.sourceUrl=b,this.members=[]}return b.prototype.load=function(a){var b=this;return a||(a=[]),this.members=_.map(a,function(a){return new b.modelClass(a)}),this},b.prototype.get=function(){var b=this;return a.get(this.sourceUrl).success(function(a){return b.load(a)})},b.prototype.add=function(a){var b;return b=new this.modelClass(a),b._postUrl=this.sourceUrl,this.members.push(b),b},b.prototype.addToFront=function(a){var b;return b=new this.modelClass(a),b._postUrl=this.sourceUrl,this.members.unshift(b),b},b.prototype.removeById=function(a){return _.remove(this.members,function(b){return b.id===a})},b.prototype.remove=function(a){return _.remove(this.members,function(b){return a===b})},b}()}])}.call(this),function(){angular.module("soil.model",[]).factory("SoilModel",["$http",function(a){var b;return b=function(){function b(a){this.saved={},angular.isObject(a)?this.load(a):a&&this.get(a)}return b.prototype._baseUrl="/",b.prototype._fieldsToSave=[],b.prototype._fieldsToSaveOnCreate=[],b.prototype._associations=[],b.prototype.setBaseUrl=function(a){return this._baseUrl=a},b.prototype.url=function(a){return null==a&&(a=this.id),a?this._withSlash(this._baseUrl)+a:this._postUrl||this._baseUrl},b.prototype.load=function(a){return this._clearFields(),this._setSavedData(a),_.assign(this,this._modifyDataBeforeLoad(a)),this},b.prototype.get=function(b){var c=this;return a.get(this.url(b)).success(function(a){return c.load(a)})},b.prototype.loaded=function(){return!!this.id},b.prototype.save=function(){var b=this;return this.id?a.put(this.url(),this.dataToSave()).success(function(a){return b.load(a)}):a.post(this.url(),this.dataToSave()).success(function(a){return b.load(a)})},b.prototype["delete"]=function(){var b=this;return this._checkIfLoaded(),a["delete"](this.url()).success(function(){return b.load(null)})},b.prototype.revert=function(){var a;return a=this.saved,this._clearFields(),this._setSavedData(a),_.assign(this,this._modifyDataBeforeLoad(a)),this},b.prototype.updateField=function(b){var c,d=this;return this._checkIfLoaded(),c={},c[b]=this[b],c=this._modifyDataBeforeSave(c),a.put(this.url(),c).success(function(a){var c;return d.saved=_.cloneDeep(a),c=_.pick(a,b),c=d._modifyDataBeforeLoad(c),d[b]=c[b]}).error(function(){return d.revertField(b)})},b.prototype.revertField=function(a){var b;return b=this._modifyDataBeforeLoad(this.saved),this[a]=b[a]},b.prototype.dataToSave=function(){var a,b,c=this;return b=this._fieldsToSave,this.loaded()||(b=b.concat(this._fieldsToSaveOnCreate)),a={},_.each(b,function(b){return a[b]=void 0===c[b]?null:c[b]}),this._modifyDataBeforeSave(a)},b.prototype._checkIfLoaded=function(){if(!this.loaded())throw"Operation not permitted on an unloaded model"},b.prototype._clearFields=function(){return _.forOwn(this,function(a,b,c){return"_"===_.first(b)||angular.isFunction(a)?void 0:delete c[b]})},b.prototype._withSlash=function(a){return a.replace(/\/?$/,"/")},b.prototype._fieldsToSave=[],b.prototype._modifyDataBeforeLoad=function(a){var b,c=this;return b=_.clone(a),_.each(this._associations,function(a){return a.beforeLoad(b,c)}),b},b.prototype._modifyDataBeforeSave=function(a){var b,c=this;return b=_.clone(a),_.each(this._associations,function(a){return a.beforeSave(b,c)}),b},b.prototype._setSavedData=function(a){return this.saved=a?_.cloneDeep(a):{}},b}()}])}.call(this);